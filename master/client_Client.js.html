<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>client/Client.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Client.html">Client</a><ul class='methods'><li data-type='method'><a href="Client.html#getConfigOption">getConfigOption</a></li><li data-type='method'><a href="Client.html#loadHelp">loadHelp</a></li><li data-type='method'><a href="Client.html#setConfigOption">setConfigOption</a></li></ul></li><li><a href="Command.html">Command</a><ul class='methods'><li data-type='method'><a href="Command.html#registerSubCommand">registerSubCommand</a></li><li data-type='method'><a href="Command.html#setAlias">setAlias</a></li><li data-type='method'><a href="Command.html#setSubAlias">setSubAlias</a></li></ul></li><li><a href="CommandHandler.html">CommandHandler</a><ul class='methods'><li data-type='method'><a href="CommandHandler.html#getCommand">getCommand</a></li></ul></li><li><a href="ForgeRegistry.html">ForgeRegistry</a><ul class='methods'><li data-type='method'><a href="ForgeRegistry.html#registerAlias">registerAlias</a></li><li data-type='method'><a href="ForgeRegistry.html#registerCommand">registerCommand</a></li><li data-type='method'><a href="ForgeRegistry.html#registerPlugin">registerPlugin</a></li><li data-type='method'><a href="ForgeRegistry.html#removeCommand">removeCommand</a></li><li data-type='method'><a href="ForgeRegistry.html#removePlugin">removePlugin</a></li></ul></li><li><a href="Plugin.html">Plugin</a><ul class='methods'><li data-type='method'><a href="Plugin.html#registerCommand">registerCommand</a></li><li data-type='method'><a href="Plugin.html#removeCommand">removeCommand</a></li></ul></li></ul><h3>Externals</h3><ul><li><a href="external-Client.html">Client</a></li><li><a href="external-ClientOptions.html">ClientOptions</a></li><li><a href="external-Collection.html">Collection</a></li><li><a href="external-EvaluatedPermissions.html">EvaluatedPermissions</a></li><li><a href="external-Guild.html">Guild</a></li><li><a href="external-GuildMember.html">GuildMember</a></li><li><a href="external-Message.html">Message</a></li><li><a href="external-Role.html">Role</a></li></ul><h3>Events</h3><ul><li><a href="Client.html#event:command">command</a></li><li><a href="Client.html#event:plainMessage">plainMessage</a></li><li><a href="Plugin.html#event:load">load</a></li></ul><h3>Interfaces</h3><ul><li><a href="GuildExtention.html">GuildExtention</a><ul class='methods'><li data-type='method'><a href="GuildExtention.html#changePrefix">changePrefix</a></li><li data-type='method'><a href="GuildExtention.html#disablePlugin">disablePlugin</a></li><li data-type='method'><a href="GuildExtention.html#enablePlugin">enablePlugin</a></li><li data-type='method'><a href="GuildExtention.html#registerCommand">registerCommand</a></li><li data-type='method'><a href="GuildExtention.html#removeCommand">removeCommand</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#hasRole">hasRole</a></li><li><a href="global.html#openJSON">openJSON</a></li><li><a href="global.html#openJSONSync">openJSONSync</a></li><li><a href="global.html#timeToMs">timeToMs</a></li><li><a href="global.html#writeJSON">writeJSON</a></li><li><a href="global.html#writeJSONSync">writeJSONSync</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">client/Client.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const DiscordJS = require('discord.js');
const util = require('../util');
const ForgeRegistry = require('./ForgeRegistry');
const CommandHandler = require('./CommandHandler');
const Constants = require('../Constants');
const DefaultHelp = require('../DefaultHelp').help;
const DefaultHelpSub = require('../DefaultHelp').helpSub;

/**
 * Options to be passed to used in a command
 * @typedef {Object} ForgeClientOptions
 * @property {string} [prefix='/'] The default prefix to use for a guild
 * @property {boolean} [selfBot=false] Whether or not the client is a selfbot.
 * @property {boolean} [guildConfigs=false] Whether or not the client should use per guild configs.
 * @property {boolean} [defaultHelp=true] Whether or not the client should use the default help command.
 * @property {Array&lt;string>} [enabledPlugins=[]] Array of the IDs of plugins that should be enabled by default
 * @property {function} [getConfigOption=null] Optional custom function for retreiving guild config options
 * must except the same parameters as the default one, must return a Promise
 * @property {function} [setConfigOption=null] Optional custom function for setting guild config options
 * must except the same parameters as the default one, must return a Promise
 */


/**
 * The ForgeClient
 * @extends {Client}
 */
class Client extends DiscordJS.Client {

  /**
   * @param {ForgeClientOptions} options The options to pass to the client
   */
  constructor(options = {}) {
    super(options);

    /**
     * Client plugin and command registry
     * @type {ForgeRegistry}
     */
    this.registry = new ForgeRegistry(this);

    /**
     * Client command handler
     * @type {CommandHandler}
     */
    this.commandHandler = new CommandHandler(this);

    /**
     * Default Options to use
     * @type {ForgeClientOptions}
     */
    this.options = Constants.mergeDefaults(Constants.defaults.ClientOptions, this.options);
    this.handleCommands();
    if (this.options.defaultHelp === true) {
      this.registry.registerCommand(new DefaultHelp());
    }
    if (this.options.getConfigOption !== null &amp;&amp; this.options.setConfigOption !== null) {
      this.getConfigOption = this.options.getConfigOption;
      this.setConfigOption = this.options.setConfigOption;
    }
    this.on('updateCommand', this.loadHelp.bind(this));
  }

  loadPlugins() {
    this.registry.plugins.forEach(plugin => plugin.emit('load', this));
  }

  /**
   * Loads the help command for a command
   * @param {Command} command The command to register help for
   */
  loadHelp(command) {
    const help = this.registry.commands.get('help') || new DefaultHelp();
    const HelpSub = new DefaultHelpSub(command, help);
    if (this.options.defaultHelp === true) {
      if (!this.registry.commands.has('help')) this.registry.registerCommand(help);
      if (!help.subCommands.has(command.id)) help.registerSubCommand(HelpSub);
      if (command.subCommands.size >= 1) command.subCommands.forEach(sub => HelpSub.registerSubCommand(new DefaultHelpSub(sub, HelpSub)));
    }
  }

  handleCommands() {
    this.on('message', message => this.commandHandler.handleMessage(message, message.author, message.channel, message.guild));
  }

  /**
   * Default function for getting per guild config options
   * @param {Guild} guild The guild to get the config option from
   * @param {string} prop The property to get from the guild's config file
   * @returns {Promise&lt;string|number|Array|Object>}
   */
  getConfigOption(guild, prop) {
    const defaultConfig = {
      prefix: this.options.prefix,
      commands: [],
      enabledPlugins: [],
    };
    return new Promise((resolve, reject) => {
      util.openJSON(`./configs/${guild.id}.json`).then(config => {
        resolve(config[prop] || defaultConfig[prop]);
      }).catch(reject);
    });
  }

  /**
   * Default function for changing per guilf config options
   * @param {Guild} guild The guild to set the config option for
   * @param {string} prop The property in the config to change
   * @param {string|number|Array|Object} value The value to set the config property to
   */
  setConfigOption(guild, prop, value) {
    const config = util.openJSON(`./configs/${guild.id}.json`);
    if (config) {
      config[prop] = value;
    } else {
      const defaultConfig = {
        prefix: this.options.prefix,
        commands: [],
        enabledPlugins: [],
      };
      defaultConfig[prop] = value;
      util.writeJSON(`./configs/${guild.id}.json`, defaultConfig);
    }
  }
}

module.exports = Client;
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Wed Jan 11 2017 19:16:49 GMT+0000 (UTC) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
